#WPF #WF 

[시작 자습서](시작%20자습서.md)

> [!Quote]- Quote
> - https://learn.microsoft.com/ko-kr/dotnet/framework/windows-workflow-foundation/how-to-run-a-workflow

### 01. Project 생성 및 Activity Library 참조

![](Pasted%20image%2020240423152251.png)
![](Pasted%20image%2020240423152419.png)
![](Pasted%20image%2020240423152543.png)

### 02. To modify the workflow hosting code

#### 02.01. Code
- Before : Program.cs - Main
	```cs
	// Create and cache the workflow definition.
	Activity workflow1 = new Workflow1();
	WorkflowInvoker.Invoke(workflow1);
	```
	-  [WorkflowInvoker](https://learn.microsoft.com/ko-kr/dotnet/api/system.activities.workflowinvoker) 는 메서드 호출과 같은 방식으로 워크플로를 호출하기 위한 간단한 방법을 제공하며, 지속성을 사용하지 않는 워크플로에만 사용될 수 있습니다.
- After : Program.cs - Main
	```cs
	AutoResetEvent syncEvent = new AutoResetEvent(false);

	WorkflowApplication wfApp = new WorkflowApplication(new SequentialNumberGuessWorkflow());
	wfApp.Completed = delegate (WorkflowApplicationCompletedEventArgs e)
	{
		syncEvent.Set();
	};

	wfApp.Aborted = delegate (WorkflowApplicationAbortedEventArgs e)
	{
		Console.WriteLine(e.Reason);
		syncEvent.Set();
	};

	wfApp.OnUnhandledException = delegate (WorkflowApplicationUnhandledExceptionEventArgs e)
	{
		Console.WriteLine(e.UnhandledException.ToString());
		return UnhandledExceptionAction.Terminate;
	};

	wfApp.Run();

	syncEvent.WaitOne();
	```

#### 02.02. 인수 설정
```cs
AutoResetEvent syncEvent = new AutoResetEvent(false);

var inputs = new Dictionary<string, object>() { { "MaxNumber", 100 } };

WorkflowApplication wfApp = new WorkflowApplication(new SequentialNumberGuessWorkflow(), inputs);
wfApp.Completed = delegate (WorkflowApplicationCompletedEventArgs e)
{
	int Turns = Convert.ToInt32(e.Outputs["Turns"]);
	Console.WriteLine("Congratulations, you guessed the number in {0} turns.", Turns);

	syncEvent.Set();
};

wfApp.Aborted = delegate (WorkflowApplicationAbortedEventArgs e)
{
	Console.WriteLine(e.Reason);
	syncEvent.Set();
};

wfApp.OnUnhandledException = delegate (WorkflowApplicationUnhandledExceptionEventArgs e)
{
	Console.WriteLine(e.UnhandledException.ToString());
	return UnhandledExceptionAction.Terminate;
};

wfApp.Run();

syncEvent.WaitOne();
```

#### 02.03. To resume a bookmark
```cs
AutoResetEvent syncEvent = new AutoResetEvent(false);
AutoResetEvent idleEvent = new AutoResetEvent(false);

var inputs = new Dictionary<string, object>() { { "MaxNumber", 100 } };

WorkflowApplication wfApp = new WorkflowApplication(new SequentialNumberGuessWorkflow(), inputs);
wfApp.Completed = delegate (WorkflowApplicationCompletedEventArgs e)
{
	int Turns = Convert.ToInt32(e.Outputs["Turns"]);
	Console.WriteLine("Congratulations, you guessed the number in {0} turns.", Turns);

	syncEvent.Set();
};

wfApp.Aborted = delegate (WorkflowApplicationAbortedEventArgs e)
{
	Console.WriteLine(e.Reason);
	syncEvent.Set();
};

wfApp.OnUnhandledException = delegate (WorkflowApplicationUnhandledExceptionEventArgs e)
{
	Console.WriteLine(e.UnhandledException.ToString());
	return UnhandledExceptionAction.Terminate;
};

wfApp.Idle = delegate (WorkflowApplicationIdleEventArgs e)
{
	idleEvent.Set();
};

wfApp.Run();

// Loop until the workflow completes.
WaitHandle[] handles = new WaitHandle[] { syncEvent, idleEvent };
while (WaitHandle.WaitAny(handles) != 0)
{
	// Gather the user input and resume the bookmark.
	bool validEntry = false;
	while (!validEntry)
	{
		int Guess;
		if (!Int32.TryParse(Console.ReadLine(), out Guess))
		{
			Console.WriteLine("Please enter an integer.");
		}
		else
		{
			validEntry = true;
			wfApp.ResumeBookmark("EnterGuess", Guess);
		}
	}
}
```